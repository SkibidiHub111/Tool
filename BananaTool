#!/usr/bin/env bash
set -euo pipefail

URL="http://127.0.0.1:8037/get"
TMP_DIR="${HOME}/.local/tmp/run_script"
mkdir -p "$TMP_DIR"

TMP_FILE="$TMP_DIR/rs_$(date +%s%N).sh"

cleanup() {
    [[ -f "$TMP_FILE" ]] && rm -f "$TMP_FILE"
}
trap cleanup EXIT INT TERM

if ! curl -fsS "$URL" -o "$TMP_FILE"; then
    echo "Error: cannot fetch script from $URL" >&2
    exit 1
fi

chmod 700 "$TMP_FILE"

if [[ ! -s "$TMP_FILE" ]]; then
    echo "Error: downloaded file is empty." >&2
    exit 1
fi

bash "$TMP_FILE" "$@"
